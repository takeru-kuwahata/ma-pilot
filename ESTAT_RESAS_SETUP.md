# e-Stat API & RESAS API è¨­å®šã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

è¨ºç™‚åœåˆ†æã§ä½¿ç”¨ã™ã‚‹çµ±è¨ˆAPIã®è¨­å®šã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

- **e-Stat API**: æ”¿åºœçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ï¼ˆäººå£çµ±è¨ˆï¼‰
- **RESAS API**: åœ°åŸŸçµŒæ¸ˆåˆ†æãƒ‡ãƒ¼ã‚¿ï¼ˆå•†åœãƒ‡ãƒ¼ã‚¿ã€ç”£æ¥­æ§‹é€ ï¼‰

## ç¾åœ¨ã®çŠ¶æ³

### e-Stat API
- âœ… ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã«çµ±åˆæ¸ˆã¿
- âš ï¸ APIã‚­ãƒ¼æœªè¨­å®šã®ãŸã‚ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ä¸­
- ğŸ“ TODO: å®Ÿè£…ãŒå¿…è¦ï¼ˆçµ±è¨ˆã‚³ãƒ¼ãƒ‰ã€åœ°åŸŸã‚³ãƒ¼ãƒ‰ã®ç‰¹å®šãŒè¤‡é›‘ï¼‰

### RESAS API
- âŒ æœªå®Ÿè£…ï¼ˆå°†æ¥çš„ã«è¿½åŠ äºˆå®šï¼‰

## e-Stat API ã‚­ãƒ¼å–å¾—æ–¹æ³•

### 1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²

https://www.e-stat.go.jp/mypage/user/preregister

1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
2. å±Šã„ãŸãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ç™»éŒ²

### 2. APIã‚­ãƒ¼ï¼ˆappIdï¼‰ã®å–å¾—

https://www.e-stat.go.jp/mypage/view/api

1. ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€ŒAPIã€â†’ã€ŒappIdç™ºè¡Œã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. åˆ©ç”¨ç›®çš„ã‚’å…¥åŠ›ï¼ˆä¾‹: æ­¯ç§‘åŒ»é™¢çµŒå–¶åˆ†æã‚·ã‚¹ãƒ†ãƒ ã§ã®äººå£çµ±è¨ˆå–å¾—ï¼‰
4. appIdãŒç™ºè¡Œã•ã‚Œã‚‹ï¼ˆä¾‹: `abc123def456...`ï¼‰

### 3. ç’°å¢ƒå¤‰æ•°ã«è¨­å®š

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆRender.comï¼‰**:
1. Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ ma-pilot â†’ Environment
2. ä»¥ä¸‹ã‚’è¿½åŠ :
   ```
   E_STAT_API_KEY=å–å¾—ã—ãŸappId
   ```
3. Save Changes â†’ Manual Deploy

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ**:
```bash
# backend/.env
E_STAT_API_KEY=å–å¾—ã—ãŸappId
```

## RESAS API ã‚­ãƒ¼å–å¾—æ–¹æ³•

### 1. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²

https://opendata.resas-portal.go.jp/

1. ã€Œåˆ©ç”¨ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€åˆ©ç”¨ç›®çš„ã‚’å…¥åŠ›
3. å±Šã„ãŸãƒ¡ãƒ¼ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç™»éŒ²å®Œäº†

### 2. APIã‚­ãƒ¼ã®å–å¾—

1. ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ãƒã‚¤ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒAPIã‚­ãƒ¼ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆä¾‹: `X1234567890abcdef...`ï¼‰

### 3. ç’°å¢ƒå¤‰æ•°ã«è¨­å®š

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆRender.comï¼‰**:
1. Renderãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ ma-pilot â†’ Environment
2. ä»¥ä¸‹ã‚’è¿½åŠ :
   ```
   RESAS_API_KEY=å–å¾—ã—ãŸAPIã‚­ãƒ¼
   ```
3. Save Changes â†’ Manual Deploy

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ**:
```bash
# backend/.env
RESAS_API_KEY=å–å¾—ã—ãŸAPIã‚­ãƒ¼
```

## e-Stat API å®Ÿè£…ã«ã¤ã„ã¦

### èª²é¡Œ

e-Stat APIã¯ä»¥ä¸‹ã®ç†ç”±ã§å®Ÿè£…ãŒè¤‡é›‘ã§ã™ï¼š

1. **çµ±è¨ˆã‚³ãƒ¼ãƒ‰ã®ç‰¹å®š**ãŒå¿…è¦
   - ä¾‹: å›½å‹¢èª¿æŸ»ï¼ˆçµ±è¨ˆã‚³ãƒ¼ãƒ‰: 0000030001ï¼‰
   - å¹´é½¢åˆ¥äººå£ï¼ˆè¡¨ã‚³ãƒ¼ãƒ‰: T000608ï¼‰ãªã©

2. **åœ°åŸŸã‚³ãƒ¼ãƒ‰ã®ç‰¹å®š**ãŒå¿…è¦
   - ç·¯åº¦çµŒåº¦ã‹ã‚‰å°åœ°åŸŸã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›ãŒå¿…è¦
   - å°åœ°åŸŸã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: åƒä»£ç”°åŒºç¥ç”°åœ°åŸŸ â†’ 13101001001ï¼‰

3. **APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¤‡é›‘**
   - XMLå½¢å¼
   - éšå±¤æ§‹é€ ãŒæ·±ã„

### å®Ÿè£…æ–¹é‡ï¼ˆPhase 6ä»¥é™ï¼‰

ç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ååˆ†æ©Ÿèƒ½ã—ã¦ã„ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã§å¯¾å¿œï¼š

**å„ªå…ˆåº¦: ä½**
- ç†ç”±: Google Places APIã§ç«¶åˆãƒ‡ãƒ¼ã‚¿ã¯å–å¾—æ¸ˆã¿
- ç†ç”±: äººå£çµ±è¨ˆã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§åˆ†ææ©Ÿèƒ½ã¯å‹•ä½œã—ã¦ã„ã‚‹
- ç†ç”±: APIã‚­ãƒ¼å–å¾—ã¯ç„¡æ–™ã ãŒã€å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ã„

**å®Ÿè£…æ™‚ã®å‚è€ƒ**:
```python
async def _fetch_population_data_from_estat(
    self, latitude: float, longitude: float, radius_km: float
) -> PopulationData:
    if not self.e_stat_api_key:
        return self._generate_mock_population_data(radius_km)

    try:
        # 1. ç·¯åº¦çµŒåº¦ã‹ã‚‰å°åœ°åŸŸã‚³ãƒ¼ãƒ‰ã‚’ç‰¹å®š
        area_code = await self._get_area_code_from_coordinates(latitude, longitude)

        # 2. å›½å‹¢èª¿æŸ»APIã‹ã‚‰äººå£ãƒ‡ãƒ¼ã‚¿å–å¾—
        url = 'https://api.e-stat.go.jp/rest/3.0/app/json/getStatsData'
        params = {
            'appId': self.e_stat_api_key,
            'statsDataId': '0000030001',  # å›½å‹¢èª¿æŸ»
            'cdArea': area_code,
            # ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿...
        }

        async with httpx.AsyncClient() as client:
            response = await client.get(url, params=params)
            data = response.json()

        # 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹
        return self._parse_estat_response(data)

    except Exception as e:
        print(f'Error fetching from e-Stat API: {str(e)}')
        return self._generate_mock_population_data(radius_km)
```

## RESAS API å®Ÿè£…ã«ã¤ã„ã¦

### æƒ³å®šç”¨é€”

- å•†åœãƒ‡ãƒ¼ã‚¿ï¼ˆäººã®æµã‚Œï¼‰
- ç”£æ¥­æ§‹é€ ãƒ‡ãƒ¼ã‚¿
- å°†æ¥äººå£æ¨è¨ˆ

### å®Ÿè£…æ–¹é‡ï¼ˆPhase 6ä»¥é™ï¼‰

**å„ªå…ˆåº¦: ä½**
- ç¾åœ¨ã®è¨ºç™‚åœåˆ†ææ©Ÿèƒ½ã«ã¯Google Places APIã¨ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ååˆ†
- Phase 11ï¼ˆæ©Ÿèƒ½æ‹¡å¼µï¼‰ã§é«˜åº¦ãªå•†åœåˆ†æãŒå¿…è¦ã«ãªã£ãŸéš›ã«å®Ÿè£…

## ã‚³ã‚¹ãƒˆ

### e-Stat API
- **å®Œå…¨ç„¡æ–™**
- åˆ©ç”¨åˆ¶é™: ãªã—ï¼ˆé©åˆ‡ãªåˆ©ç”¨ç¯„å›²å†…ï¼‰

### RESAS API
- **å®Œå…¨ç„¡æ–™**
- åˆ©ç”¨åˆ¶é™: ãªã—ï¼ˆé©åˆ‡ãªåˆ©ç”¨ç¯„å›²å†…ï¼‰

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### e-Stat API

**ã‚¨ãƒ©ãƒ¼: "appIdãŒç„¡åŠ¹ã§ã™"**
â†’ APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**ã‚¨ãƒ©ãƒ¼: "çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"**
â†’ çµ±è¨ˆã‚³ãƒ¼ãƒ‰ã€è¡¨ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ã„ã‹ç¢ºèª

### RESAS API

**ã‚¨ãƒ©ãƒ¼: "APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™"**
â†’ X-API-KEYãƒ˜ãƒƒãƒ€ãƒ¼ã«æ­£ã—ã„ã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**ã‚¨ãƒ©ãƒ¼: "å¸‚åŒºç”ºæ‘ã‚³ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã§ã™"**
â†’ 5æ¡ã®å¸‚åŒºç”ºæ‘ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: 13101ï¼‰ãŒæ­£ã—ã„ã‹ç¢ºèª

## å‚è€ƒãƒªãƒ³ã‚¯

### e-Stat API
- [APIä»•æ§˜æ›¸](https://www.e-stat.go.jp/api/api-info/api-spec)
- [çµ±è¨ˆè¡¨ä¸€è¦§](https://www.e-stat.go.jp/stat-search/files?page=1)
- [APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](https://www.e-stat.go.jp/api/api-info/e-stat-manual3-0)

### RESAS API
- [APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://opendata.resas-portal.go.jp/docs/api/v1/index.html)
- [åˆ©ç”¨è¦ç´„](https://opendata.resas-portal.go.jp/terms.html)

## ã¾ã¨ã‚

### ä»Šã™ãå¯¾å¿œã™ã¹ãã“ã¨

1. âœ… **Google Maps APIè«‹æ±‚è¨­å®š**ï¼ˆGOOGLE_MAPS_SETUP.mdå‚ç…§ï¼‰
   - å„ªå…ˆåº¦: **é«˜**
   - ç†ç”±: åœ°å›³è¡¨ç¤ºã¨ãƒãƒ¼ã‚«ãƒ¼ã«å¿…è¦

### å¾Œã§å¯¾å¿œã™ã‚‹ã“ã¨

2. â³ **e-Stat APIã‚­ãƒ¼å–å¾—**
   - å„ªå…ˆåº¦: **ä¸­**
   - ç†ç”±: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãŒæœ›ã¾ã—ã„ãŒã€ãƒ¢ãƒƒã‚¯ã§ã‚‚æ©Ÿèƒ½ã—ã¦ã„ã‚‹

3. â³ **e-Stat APIå®Ÿè£…**
   - å„ªå…ˆåº¦: **ä½**
   - ç†ç”±: å®Ÿè£…ã‚³ã‚¹ãƒˆãŒé«˜ãã€ç¾çŠ¶ã§ååˆ†æ©Ÿèƒ½ã—ã¦ã„ã‚‹

4. â³ **RESAS APIã‚­ãƒ¼å–å¾—ï¼†å®Ÿè£…**
   - å„ªå…ˆåº¦: **ä½**
   - ç†ç”±: Phase 11ã®æ©Ÿèƒ½æ‹¡å¼µæ™‚ã«æ¤œè¨
