# 印刷物複数注文機能 UI設計案

**作成日**: 2026年2月26日
**目的**: 1回の注文で複数の商品を発注できるようにする

---

## 現状の課題

現在の印刷物注文フォームは、1商品のみの注文に対応しています。
例えば「診察券1,000枚」と「名刺100枚」を同時に注文したい場合、2回に分けて注文する必要があります。

---

## 提案する2つの方式

### 方式A: カート方式（推奨）

#### 画面フロー
1. 商品選択画面 → 2. カート確認画面 → 3. 送信完了画面

#### メリット
- ✅ 見やすい・分かりやすい
- ✅ 後から数量を変更しやすい
- ✅ 合計金額が一目で分かる
- ✅ 商品を削除しやすい

#### デメリット
- ⚠️ 画面遷移が増える（ステップ数: 2→3）
- ⚠️ 開発工数が若干多い

#### 画面イメージ

**画面1: 商品追加画面**
```
┌─────────────────────────────────────┐
│ 印刷物注文フォーム                   │
├─────────────────────────────────────┤
│                                     │
│ 商品種類: [診察券 ▼]                │
│ 数量:    [1,000 ▼]                  │
│ 見積もり金額: ¥25,500               │
│                                     │
│ [カートに追加] [注文を確認する >]   │
│                                     │
├─────────────────────────────────────┤
│ 🛒 カート (2商品)                    │
│                                     │
│ 診察券 1,000枚 ........... ¥25,500  │
│ 名刺 100枚 ................. ¥2,500  │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━          │
│ 合計: ¥28,000                       │
└─────────────────────────────────────┘
```

**画面2: カート確認画面**
```
┌─────────────────────────────────────┐
│ 注文内容の確認                       │
├─────────────────────────────────────┤
│ クリニック名: 〇〇歯科               │
│ メールアドレス: xxx@example.com     │
│                                     │
│ 【注文内容】                        │
│                                     │
│ 1. 診察券 1,000枚                   │
│    単価: ¥25,500  [削除]            │
│                                     │
│ 2. 名刺 100枚                       │
│    単価: ¥2,500   [削除]            │
│                                     │
│ 納期希望日: 2026/03/15              │
│ □ デザイン作成を依頼する            │
│                                     │
│ 備考・ご要望:                       │
│ ┌─────────────────────────────────┐ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━          │
│ 合計金額: ¥28,000                   │
│                                     │
│ [< 戻る] [注文を確定する]           │
└─────────────────────────────────────┘
```

---

### 方式B: 1画面完結方式

#### 画面フロー
1. 商品選択・送信画面（1画面のみ）

#### メリット
- ✅ 画面遷移が少ない（ステップ数: 1）
- ✅ 開発工数が少ない

#### デメリット
- ⚠️ 商品が増えるとスクロールが長くなる
- ⚠️ 合計金額が見えにくい（スクロール必要）
- ⚠️ 商品の削除・編集がやりにくい

#### 画面イメージ

```
┌─────────────────────────────────────┐
│ 印刷物注文フォーム                   │
├─────────────────────────────────────┤
│                                     │
│ 【商品1】                           │
│ 商品種類: [診察券 ▼]                │
│ 数量:    [1,000 ▼]                  │
│ 見積もり: ¥25,500                   │
│                                     │
│ 【商品2】                [削除]     │
│ 商品種類: [名刺 ▼]                  │
│ 数量:    [100 ▼]                    │
│ 見積もり: ¥2,500                    │
│                                     │
│ [+ 商品を追加]                      │
│                                     │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━          │
│ 合計金額: ¥28,000                   │
│                                     │
│ クリニック名: [        ]            │
│ メールアドレス: [      ]            │
│ 納期希望日: [2026/03/15]            │
│ □ デザイン作成を依頼する            │
│                                     │
│ 備考・ご要望:                       │
│ ┌─────────────────────────────────┐ │
│ │                                 │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [注文を送信]                        │
└─────────────────────────────────────┘
```

---

## 推奨方式: 方式A（カート方式）

### 理由

1. **ユーザビリティ**
   - 注文内容を確認しやすい
   - 間違いに気づきやすい
   - 修正・削除がしやすい

2. **実用性**
   - 医院スタッフは「まず商品を選んで、後で確認する」フローに慣れている
   - Amazonや楽天などのECサイトと同じ操作感

3. **拡張性**
   - 将来的に「保存された注文履歴から再注文」機能を追加しやすい
   - 「下書き保存」機能も追加可能

---

## 技術的な実装ポイント

### データ構造

#### カート状態管理（Zustand）
```typescript
interface CartItem {
  id: string;                    // 一時ID
  product_type: string;          // 商品種類
  quantity: number;              // 数量
  price: number;                 // 単価
  estimated_price: number;       // 見積もり金額
  delivery_days: number;         // 納期日数
}

interface CartStore {
  items: CartItem[];
  addItem: (item: CartItem) => void;
  removeItem: (id: string) => void;
  clearCart: () => void;
  getTotalPrice: () => number;
}
```

#### バックエンドAPI変更
現在の `/api/print-orders` エンドポイントは単一商品のみ対応。
複数商品に対応するため、以下の変更が必要：

**変更前**:
```json
{
  "clinic_name": "〇〇歯科",
  "email": "xxx@example.com",
  "product_type": "診察券",
  "quantity": 1000,
  "notes": "備考"
}
```

**変更後**:
```json
{
  "clinic_name": "〇〇歯科",
  "email": "xxx@example.com",
  "items": [
    {
      "product_type": "診察券",
      "quantity": 1000
    },
    {
      "product_type": "名刺",
      "quantity": 100
    }
  ],
  "notes": "備考"
}
```

### データベーススキーマ変更

現在の `print_orders` テーブル:
```sql
CREATE TABLE print_orders (
  id UUID PRIMARY KEY,
  clinic_name TEXT,
  product_type TEXT,  -- 単一商品のみ
  quantity INTEGER,
  ...
);
```

変更案（2パターン）:

#### パターン1: 注文明細テーブルを分離（推奨）
```sql
-- 注文ヘッダー
CREATE TABLE print_orders (
  id UUID PRIMARY KEY,
  clinic_name TEXT,
  email TEXT,
  notes TEXT,
  total_price INTEGER,
  status TEXT,
  created_at TIMESTAMP
);

-- 注文明細
CREATE TABLE print_order_items (
  id UUID PRIMARY KEY,
  order_id UUID REFERENCES print_orders(id),
  product_type TEXT,
  quantity INTEGER,
  price INTEGER,
  created_at TIMESTAMP
);
```

#### パターン2: JSONB型で保存（簡易）
```sql
CREATE TABLE print_orders (
  id UUID PRIMARY KEY,
  clinic_name TEXT,
  items JSONB,  -- 複数商品をJSON配列で保存
  notes TEXT,
  total_price INTEGER,
  status TEXT,
  created_at TIMESTAMP
);
```

---

## 実装スケジュール（目安）

### フェーズ1: カートUI実装（2〜3時間）
- カート状態管理（Zustand）
- 商品追加画面の実装
- カート表示コンポーネント

### フェーズ2: 確認画面実装（1〜2時間）
- 注文確認画面の実装
- 合計金額計算
- 商品削除機能

### フェーズ3: バックエンド対応（2〜3時間）
- データベーススキーマ変更
- APIエンドポイント修正
- 注文明細の保存処理

### フェーズ4: テスト・調整（1〜2時間）
- 動作確認
- エッジケース対応（カート空、1商品のみ等）
- UI調整

**合計**: 6〜10時間程度

---

## クライアント様への確認事項

1. **方式の選択**
   - 方式A（カート方式・推奨）でよろしいでしょうか？
   - または方式B（1画面完結）をご希望でしょうか？

2. **優先度**
   - すぐに実装すべき機能でしょうか？
   - それとも他の機能（スマホ対応等）の後でもよろしいでしょうか？

3. **その他要望**
   - 「よく注文する組み合わせ」を保存できる機能は必要でしょうか？
   - 注文履歴から「同じ内容で再注文」ボタンは必要でしょうか？

---

**作成者**: 開発担当
**次のアクション**: クライアント様のご確認をお待ちしております
