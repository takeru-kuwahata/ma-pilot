# 診療圏分析機能 - タスク分離（クライアント vs 開発者）

**最終更新**: 2026-02-04

## 📊 現在の実装状況

### ✅ 実装済み（枠組み）

| 項目 | 状態 | 備考 |
|------|------|------|
| UI（フロント） | ✅ 完成 | レイアウト、カード、地図エリア全て表示 |
| バックエンドAPI | ✅ 実装済み | GET/POST エンドポイント実装 |
| データベース | ✅ テーブル作成済み | market_analyses テーブル |

### ❌ 未実装（データ取得ロジック）

| 項目 | 状態 | 理由 |
|------|------|------|
| 統計データ（人口、高齢化率等） | ❌ 0表示 | 外部API未統合 |
| Google Maps地図表示 | ❌ プレースホルダー | 「Phase 5以降」 |
| 競合歯科医院データ | ❌ 「データがありません」 | 外部API未統合 |
| 人口統計詳細データ | ❌ プレースホルダー | 「Phase 6以降で実装」 |

---

## 🎯 意図通りの状態か？

### 回答: **はい、意図通りです**

**理由**:
1. **外部API統合が未実装**のため、実データが表示されない
2. UI枠組みは**Phase 4で完成**、データ取得は**Phase 5-6で実装予定**
3. 外部APIキー（e-Stat, RESAS, Google Maps）の設定が必要

**表示されている「Phase 5以降」「Phase 6以降で実装」は意図的なメッセージ**

---

## 👤 クライアントのタスク vs 👨‍💻 開発者のタスク

### 👤 クライアントのタスク（医院側で実施）

#### 1. 医院の住所・位置情報の登録
- **必要な情報**:
  - 郵便番号
  - 住所（完全な住所）
  - 緯度・経度（自動取得可能だが、手動設定も可）

- **登録方法**:
  - 「医院設定」ページから入力
  - 初回ログイン時に登録フォームが表示される（実装予定）

- **現状**:
  - デモ医院（さくら歯科クリニック）の住所は登録済み
  - `latitude: 35.6762, longitude: 139.7025`（東京都渋谷区神宮前）

#### 2. 外部APIキーの入手（オプション）
- **不要**: 開発者側で一括取得・設定
- クライアントは何もしなくてOK

### 👨‍💻 開発者のタスク（実装が必要）

#### ✅ 完了済み
- [x] UI枠組み実装（フロントエンド）
- [x] バックエンドAPI実装（GET/POST）
- [x] データベーステーブル作成（market_analyses）

#### ❌ 未実装（Phase 5-6）

##### 1. 外部APIキーの取得と設定
- **e-Stat API**:
  - 取得先: https://www.e-stat.go.jp/api/
  - 用途: 小地域別人口統計データ
  - 無料・登録制

- **RESAS API**:
  - 取得先: https://opendata.resas-portal.go.jp/
  - 用途: 商圏データ、産業構造、人口動態
  - 無料・登録制

- **Google Maps API**:
  - 取得先: https://console.cloud.google.com
  - 用途: 地図表示、競合歯科医院検索
  - 月10,000リクエストまで無料

- **設定場所**:
  - `backend/.env` ファイル
  - システム設定ページから設定可能（未実装）

##### 2. Google Maps統合
- **実装内容**:
  - Google Maps JavaScript API
  - 医院の位置を中心に地図表示
  - 半径2km圏内を円で表示
  - 競合歯科医院をマーカー表示

- **工数**: 2-3日

##### 3. e-Stat API統合（人口統計データ取得）
- **実装内容**:
  - 医院の緯度経度から小地域コード取得
  - 人口統計API呼び出し
  - 年齢層別人口データ取得・集計

- **工数**: 2-3日

##### 4. Google Places API統合（競合医院検索）
- **実装内容**:
  - 半径2km圏内の歯科医院検索
  - 医院名、住所、距離を取得
  - データベースに保存

- **工数**: 1-2日

##### 5. データ更新ロジック
- **実装内容**:
  - 定期的なデータ更新（月次、または手動更新）
  - キャッシュ機能（API呼び出し削減）

- **工数**: 1日

---

## 📋 現在表示されているデータ

### スクリーンショットの確認結果

| 項目 | 表示値 | 期待値 | 判定 |
|------|--------|--------|------|
| 診療圏人口（半径2km） | 0人 | 約30,000人（推定） | ❌ 未実装 |
| 高齢化率 | 0.0% | 約25%（推定） | ❌ 未実装 |
| 競合歯科医院数（半径2km） | 0院 | 約5-10院（推定） | ❌ 未実装 |
| 市場ポテンシャル | 0点 | 算出値 | ❌ 未実装 |
| 診療圏マップ | プレースホルダー | Google Maps表示 | ❌ 未実装 |
| 周辺競合歯科医院 | 「データがありません」 | 競合一覧 | ❌ 未実装 |
| 診療圏内人口統計 | プレースホルダー | 年齢層別グラフ | ❌ 未実装 |

**結論**: 全て0表示・プレースホルダーは**意図通り**（外部API未統合のため）

---

## 🎯 実装優先度

### 🔴 優先度: 高（クライアントテスト前に必要）

**なし**
- 診療圏分析は「あったらいい機能」であり、クライアントの日常運用に必須ではない

### 🟡 優先度: 中（運用開始後に実装）

1. **Google Maps統合**（工数: 2-3日）
   - 地図表示で視覚的に分かりやすい
   - クライアントからの要望が高い可能性

2. **競合医院検索**（工数: 1-2日）
   - Google Places API統合
   - 周辺の歯科医院情報を自動取得

### 🟢 優先度: 低（Phase 6以降）

3. **e-Stat API統合**（工数: 2-3日）
   - 詳細な人口統計データ
   - 経営判断の参考データ

4. **RESAS API統合**（工数: 2-3日）
   - 商圏データ、産業構造
   - より高度な分析

---

## 📝 クライアントへの説明例

### 現状の説明

「診療圏分析ページは枠組みが完成しています。現在は外部API（人口統計データ、地図サービス等）との連携が未実装のため、統計データが0と表示されています。

運用開始後、必要に応じて以下の機能を段階的に実装します:
1. Google Maps地図表示
2. 周辺競合歯科医院の自動検索
3. 人口統計データ（e-Stat API）
4. 商圏分析データ（RESAS API）

これらは日常的な経営管理には必須ではないため、優先度を調整して実装します。」

---

## 🔧 暫定対応（現在）

### クライアントテスト時の対応

**オプション1: 機能説明のみ**
- 「この機能は今後実装予定です」と説明
- クライアントは特に操作不要

**オプション2: デモデータ表示**
- 開発者が手動でダミーデータをデータベースに投入
- クライアントは画面を見るだけ（実データではないことを説明）

**推奨**: オプション1（機能説明のみ）

---

## ✅ チェックリスト検証結果（3.3）

| # | 項目 | 期待結果 | 実際の結果 | 判定 |
|---|------|----------|----------|------|
| 3.3.1 | ページ表示 | 診療圏分析ページが表示 | ✅ 表示される | ✅ OK |
| 3.3.2 | 統計カード表示 | 4枚のカードが表示 | ✅ 表示される | ✅ OK |
| 3.3.3 | 統計データ表示 | 人口、高齢化率等が表示 | ❌ 0表示 | ⚠️ 意図通り（未実装） |
| 3.3.4 | 地図表示 | Google Maps地図が表示 | ❌ プレースホルダー | ⚠️ 意図通り（Phase 5以降） |
| 3.3.5 | 競合医院一覧 | 周辺歯科医院が表示 | ❌ 「データがありません」 | ⚠️ 意図通り（未実装） |

**結論**: UI枠組みは完成。データ取得ロジック（外部API統合）は未実装で、これは**意図通り**。

---

## 🚀 次のステップ

### クライアントテスト前（現在）
- ✅ 何もしない（機能説明のみ）
- 診療圏分析は「将来実装予定の機能」として扱う

### 運用開始後（Phase 5-6）
1. 外部APIキー取得（開発者）
2. Google Maps統合実装
3. 競合医院検索実装
4. e-Stat/RESAS API統合実装

**総工数見積もり**: 5-8日（Phase 5-6完了まで）
