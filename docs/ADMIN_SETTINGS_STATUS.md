# システム設定ページ（/admin/settings）実装状況

**最終更新**: 2026-02-03

## 📊 実装状況サマリー

| カテゴリ | 実装済み機能 | 未実装機能 | 実装率 |
|---------|------------|-----------|--------|
| 外部API設定 | 0/3 | 3/3 | 0% |
| メール設定 | 0/2 | 2/2 | 0% |
| システム全般設定 | 2/3 | 1/3 | 67% |
| データ管理 | 0/3 | 3/3 | 0% |
| **合計** | **2/11** | **9/11** | **18%** |

---

## 1. 外部API設定

### ✅ 実装済み
なし

### ❌ 未実装

#### 1.1 API設定の保存
- **UI**: 「保存する」ボタン（表示済み）
- **フロントエンド**: `handleSaveApiSettings()` - TODO（70行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/api-settings` PUT エンドポイント実装
  - データベース: `admin_settings` テーブルまたは環境変数管理
  - フロントエンド: `adminService.updateApiSettings()` 実装

#### 1.2 接続テスト
- **UI**: 「接続テスト」ボタン（表示済み）
- **フロントエンド**: `handleTestConnection()` - TODO（74行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/test-connection` POST エンドポイント実装
  - 各API（e-Stat, RESAS, Google Maps）への実際の接続テスト
  - フロントエンド: 結果表示（成功/失敗アラート）

#### 1.3 Supabase URL表示
- **UI**: 「Supabase URL」フィールド（ハードコード値表示中）
- **状態**: `https://your-project.supabase.co`（ダミー値）
- **必要な作業**:
  - バックエンドから実際の環境変数を取得して表示

---

## 2. メール設定

### ✅ 実装済み
なし

### ❌ 未実装

#### 2.1 メール設定の保存
- **UI**: 「保存する」ボタン（表示済み）
- **フロントエンド**: `handleSaveEmailSettings()` - TODO（78行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/email-settings` PUT エンドポイント実装
  - データベース: `admin_settings` テーブルにメール設定カラム追加
  - フロントエンド: `adminService.updateEmailSettings()` 実装

#### 2.2 テストメール送信
- **UI**: 「テストメール送信」ボタン（表示済み）
- **フロントエンド**: `handleSendTestEmail()` - TODO（82行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/send-test-email` POST エンドポイント実装
  - SMTPサーバー接続・メール送信ロジック実装
  - フロントエンド: 送信結果表示

---

## 3. システム全般設定

### ✅ 実装済み

#### 3.1 設定の取得
- **バックエンド**: `/api/admin/settings` GET - **実装済み**（admin.py:94-104）
- **フロントエンド**: `adminService.getSettings()` - **実装済み**（adminService.ts:83-89）
- **状態**: Placeholderとして固定値を返す
  - `maintenance_mode`: false
  - `max_clinics`: 100
  - `data_retention_days`: 365

#### 3.2 設定の更新
- **バックエンド**: `/api/admin/settings` PUT - **実装済み**（admin.py:107-114）
- **フロントエンド**: `adminService.updateSettings()` - **実装済み**（adminService.ts:91-98）
- **状態**: Placeholderとして受け取った値をそのまま返す（実際の保存なし）

### ❌ 未実装

#### 3.3 設定のデータベース永続化
- **現状**: バックエンドAPIは実装済みだが、データベースへの保存は未実装
- **必要な作業**:
  - データベース: `admin_settings` テーブル作成
  - バックエンド: 実際の保存・読み込みロジック実装
  - フロントエンド: UIと既存APIを接続

---

## 4. データ管理

### ✅ 実装済み
なし

### ❌ 未実装

#### 4.1 データエクスポート
- **UI**: 「データをエクスポート」ボタン（表示済み）
- **フロントエンド**: `handleExportData()` - TODO（90行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/export-data` GET エンドポイント実装
  - CSV/JSON形式でのデータエクスポート機能
  - フロントエンド: ファイルダウンロード処理

#### 4.2 非アクティブ医院削除
- **UI**: 「非アクティブ医院を削除」ボタン（表示済み、警告アイコン付き）
- **フロントエンド**: `handleDeleteInactiveClinics()` - TODO（94行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/delete-inactive-clinics` DELETE エンドポイント実装
  - 確認ダイアログ実装（重要な操作のため）
  - 削除前のバックアップ推奨

#### 4.3 古いログ削除
- **UI**: 「古いログを削除」ボタン（表示済み、警告アイコン付き）
- **フロントエンド**: `handleDeleteOldLogs()` - TODO（98行目）
- **バックエンド**: エンドポイントなし
- **必要な作業**:
  - バックエンド: `/api/admin/delete-old-logs` DELETE エンドポイント実装
  - ログテーブルの設計・実装
  - 保持期間の設定（システム全般設定の`data_retention_days`を使用）

---

## 📝 実装優先度の提案

### 🔴 優先度: 高（クライアントテストに必要）

**なし** - システム設定は管理者専用機能であり、クライアントの日常的な運用には不要

### 🟡 優先度: 中（運用開始後に必要）

1. **システム全般設定のデータベース永続化**
   - 現状: API実装済みだが保存されない
   - 影響: 設定変更が反映されない
   - 工数: 1-2日

2. **メール設定の保存とテストメール送信**
   - 用途: パスワードリセット、通知メール送信
   - 工数: 2-3日

### 🟢 優先度: 低（将来的な拡張機能）

3. **外部API設定の保存と接続テスト**
   - 現状: 環境変数で管理中
   - 工数: 2-3日

4. **データエクスポート機能**
   - 用途: バックアップ、データ移行
   - 工数: 1-2日

5. **データ削除機能（非アクティブ医院、古いログ）**
   - 用途: データベース容量管理
   - 工数: 2-3日（確認ダイアログ含む）

---

## 🎯 推奨アクション

### クライアントテスト前（現在）
- ✅ **何もしない** - システム設定はクライアントテストに不要
- ✅ UIは既に実装済みで、見た目は正常
- ✅ 実際の機能実装は運用開始後に優先度に応じて実施

### 運用開始後（Phase 11）
1. システム全般設定のデータベース永続化
2. メール設定の実装（パスワードリセット機能に必要）
3. その他の機能は必要に応じて順次実装

---

## 検証結果

**UI表示**: ✅ 正常（全ての入力フィールド、ボタンが表示される）

**バックエンド連携状況**:
- ✅ 設定取得（GET /api/admin/settings）: 実装済み（Placeholder）
- ✅ 設定更新（PUT /api/admin/settings）: 実装済み（Placeholder）
- ❌ その他の機能: 全て未実装（TODO）

**結論**:
- UIは完成しているが、ほとんどの機能がバックエンド連携未実装
- クライアントテストには影響なし（管理者専用機能のため）
- 運用開始後に必要に応じて段階的に実装することを推奨
