# MA-Pilot よくある質問（FAQ）

## 開発・セットアップ

### Q: 開発環境でSupabaseに接続できません

**A**: 以下を確認してください:

1. `.env.local`に正しいSupabase URLとAnon Keyが設定されているか
2. Anon Keyが`sb_publishable_`で開始しているか（新形式）
3. SupabaseプロジェクトがPausedになっていないか
4. ネットワーク接続が正常か

詳細は[トラブルシューティング](TROUBLESHOOTING.md#supabase接続エラー)を参照してください。

---

### Q: フロントエンドとバックエンドのポート番号は？

**A**:
- **フロントエンド**: `http://localhost:3247`
- **バックエンド**: `http://localhost:8432`

複数プロジェクトの並行開発を考慮し、一般的でないポート番号を使用しています。

---

### Q: 本番環境の環境変数はどこで設定しますか？

**A**:
- **Vercel（フロントエンド）**: Vercelダッシュボード→プロジェクト→Settings→Environment Variables
- **Render.com（バックエンド）**: Render.comダッシュボード→サービス→Environment

詳細は[運用ガイド](OPERATIONS_GUIDE.md#環境変数設定)を参照してください。

---

### Q: データベースマイグレーションはどうやりますか？

**A**: Supabase SQL Editorで以下のファイルを実行:

```bash
backend/supabase_schema.sql
```

スキーマ変更が必要な場合:
1. `supabase_schema.sql`を編集
2. Supabase SQL Editorで実行
3. 型定義（`frontend/src/types/index.ts`、`backend/src/types/index.ts`）を同期更新

---

### Q: テストデータの作り方は？

**A**: 開発環境では以下のテストアカウントを使用できます:

```yaml
システム管理者:
  email: admin@ma-pilot.local
  email: kuwahata@idw-japan.net
  password: advance2026

テスト医院オーナー:
  email: owner@test-clinic.local
  password: TestOwner2025!
```

月次データは「基礎データ管理」から手動入力するか、CSVサンプルファイルをインポートしてください。

---

## 機能・仕様

### Q: ユーザーロールの違いは？

**A**:

| ロール | 閲覧 | 編集 | 削除 | スタッフ管理 | 全医院アクセス |
|--------|-----|------|------|------------|--------------|
| システム管理者 | ✓ | ✓ | ✓ | ✓ | ✓ |
| 医院オーナー | ✓ | ✓ | ✓ | ✓ | - |
| 医院編集者 | ✓ | ✓ | - | - | - |
| 医院閲覧者 | ✓ | - | - | - | - |

詳細は[データベーススキーマ](DATABASE_SCHEMA.md#user_metadataテーブル)を参照してください。

---

### Q: PILOTデータは自動で取り込まれますか？

**A**: MVP版では手動CSVエクスポート運用です。

1. PILOTから月次データをCSVエクスポート
2. MA-Pilotで「CSV取込」機能を使用してインポート

将来的には、PILOT Webhook転送機能（月額5,500円）を導入してリアルタイム自動連携を予定しています。

---

### Q: レポートはどのような形式で生成されますか？

**A**: 以下の2形式に対応:

- **PDF**: グラフ・表・文章を含む包括的なレポート
- **CSV**: 月次データの生データ（Excel分析用）

PDF生成にはWeasyPrintを使用し、グラフはmatplotlibで画像化して埋め込んでいます。

---

### Q: 診療圏分析の精度は？

**A**: 以下のデータソースを使用:

- **人口統計**: e-Stat API（政府統計）
- **商圏データ**: RESAS API
- **競合医院**: Google Maps API

精度は高いですが、リアルタイムデータではないため、最新の状況と若干のズレが生じる可能性があります。

---

## トラブル・エラー

### Q: 「データベース接続エラー」が頻繁に出ます

**A**: 以下を確認してください:

1. Supabase無料プランの制限
   - 7日間非アクティブで一時停止
   - Supabaseダッシュボードでプロジェクトを再開

2. ネットワーク問題
   - VPNやファイアウォール設定を確認

3. 環境変数
   - `SUPABASE_URL`と`SUPABASE_KEY`が正しいか確認

---

### Q: CSVインポートでエラーが出ます

**A**: よくあるエラーと対処法:

1. **フォーマットエラー**
   - カラム名が正しいか確認
   - UTF-8 BOM付きで保存

2. **数値フォーマットエラー**
   - カンマ（,）や¥記号を削除
   - 例: `5,000,000` → `5000000`

3. **日付フォーマットエラー**
   - YYYY-MM形式を使用
   - 例: `2024-1` → `2024-01`

詳細は[トラブルシューティング](TROUBLESHOOTING.md#csvインポートが失敗する)を参照してください。

---

### Q: ページ読み込みが遅いです

**A**: 以下を試してください:

1. **ブラウザキャッシュクリア**
   - Ctrl+Shift+Delete（Chrome）
   - キャッシュと Cookie をクリア

2. **React Queryキャッシュ**
   - ブラウザをリロード（Ctrl+F5）

3. **ネットワーク確認**
   - ブラウザ開発者ツール→Networkタブで遅いリクエストを特定

4. **バックエンド確認**
   - Render.com無料プランは15分間アクセスなしでスリープ
   - 初回アクセス時は起動に時間がかかる

---

## デプロイ・運用

### Q: Vercelデプロイが失敗します

**A**: よくある原因:

1. **環境変数未設定**
   - Vercelダッシュボードで`VITE_SUPABASE_URL`等を設定

2. **ビルドエラー**
   - ローカルで`npm run build`が成功するか確認
   - TypeScript型エラーを修正

3. **メモリ不足**
   - Vercel無料プランのメモリ制限内か確認

---

### Q: Render.comバックエンドがスリープします

**A**: Render.com無料プランは15分間アクセスなしで自動スリープします。

**対処法**:
- **Cron Job**: 定期的にヘルスチェックエンドポイントにアクセス
- **有料プラン**: Proプラン以上でスリープなし

---

### Q: データベースバックアップはどうなっていますか？

**A**: Supabaseが自動バックアップを実施:

- **頻度**: 毎日
- **保持期間**: 無料プラン7日間、Proプラン30日間
- **リストア**: Supabaseダッシュボードから実行可能

手動バックアップも可能です。詳細は[運用ガイド](OPERATIONS_GUIDE.md#バックアップリストア)を参照してください。

---

## その他

### Q: ソースコードの商用利用は可能ですか？

**A**: はい、MITライセンスの下で商用利用可能です。

詳細は[LICENSE](../LICENSE)を参照してください。

---

### Q: 新機能のリクエストはどこでできますか？

**A**: 以下の方法で提案してください:

1. **GitHub Issues**: https://github.com/takeru-kuwahata/ma-pilot/issues
2. **メール**: support@ma-pilot.local

詳細は[コントリビューションガイド](../CONTRIBUTING.md)を参照してください。

---

### Q: サポート対応時間は？

**A**: 現在、公式サポートは提供していません。

GitHub Issuesで質問いただければ、コミュニティベースで回答します。

---

**最終更新**: 2025年12月26日
